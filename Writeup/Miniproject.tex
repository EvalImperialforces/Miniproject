\documentclass[12pt]{article}
\usepackage{graphicx}
\usepackage{siunitx}
\usepackage{gensymb}
\usepackage{booktabs}
\usepackage{amsmath}
\usepackage{float}
\usepackage{placeins}
\usepackage{titling} %For document header
\usepackage{adjustbox} % Table width
\usepackage{caption} % Space between table and caption
\usepackage{subcaption}
\usepackage{apacite}
\usepackage{setspace}
\usepackage[inner=3cm,outer=3cm,bottom=2cm]{geometry}
\usepackage{lineno}
\usepackage{lmodern}
\usepackage[T1]{fontenc}
\renewcommand{\arraystretch}{1.5} % Increase default space in tables
%\linespread{1.5}
\doublespacing

\begin{document}
\begin{titlepage}
		\centering
		
		\vspace{1cm}
		%Thesis title
		{\uppercase{\textbf{\Large Investigating the use of Phenomenological and Mechanistic Models to Fit the Thermal Responses of Metabolic Traits\\}}}
		\vspace{1cm}
		%Author's name
		{\Large Eva Linehan\par}
		\vspace{2cm}
		
		\includegraphics[width=0.4\textwidth]{crest.png}
		
		\vspace{1.7cm}
		
		Computational Methods in Ecology and Evolution\\
		Miniproject
		
		\vspace{0.8cm}
		
		Imperial College London\\
		March 2019\\
		WC 1924
	%\end{center}
\end{titlepage}


%\college{Imperial College London}


\tableofcontents
\newpage
\begin{linenumbers}
\section{Abstract}
\section{Introduction}
It has been argued that life is a response to the thermodynamic requirements of dissipating systems, providing criteria for evaluating growth and development across a range of biological systems \cite{Schneider2007OrderFD}. The importance of thermodynamic imperatives in fluctuating environments and in ecosystem maintenance cannot be understated in this present climate. The most recent IPCC 2018 report \cite{IPCC2018} identified the investigation of thermal responses across terrestrial, coastal and oceanic ecosystems as crucial gap in our knowledge and in the understanding of mechanistic processes by which organisms react to Earth's rapidly changing thermal landscape. To observe the profound effects of temperature on biological functions at all levels of organization, temperature performance curves are commonly used.

 
Temperature performance curves (TPCs) incorporate temperature tolerance and temperature-dependent effects on performance from the whole-organism level, including growth and metabolic rate, to the underlying physiological level which include functions such as enzyme activity \cite{10.1093/icb/icr097}\cite{doi:10.1890/12-2060.1}. The effects of temperature on performance traits, illustrated by TPCs, follow a general trend
with three distinct phases: (1) a growth phase with trait performance increasing with temperature; (2) a peak or thermal optimum at the highest trait value; followed by (3) a sharp decline at higher temperatures \cite{Schulte2015TheEO}.This unimodal, left skewed distribution has been described by both phenomenological and mechanistic models in order to capture the general features observed for trait values across a range of temperatures. There is currently no one general model favoured over another which may be explained by the fundamental differences between biological responses among taxa \cite{pub.1026914980}\cite{doi:10.1002/ece3.3576}. An ideal generalized model may be hard to derive as although complex models often perform poorly in relation to a more simple counterpart, they can be improved when wider temperature ranges are applied \cite{Quinn2017ACR}. Phenomenological models, often used to predict thermal responses, lack any meaningful parameter interpretation and as a result are flexible tools that can be used to model any species or fitness component \cite{Martin2017PhenomenologicalVB}. The unknown suitability for such models in different conditions may lead to underestimation. In contrast, mechanistic models are used to explain the processes underlying phenomena in emprical data and are established on a theoretical basis. The mechanistic basis for model predictions provides a useful criterion in a range of applications, such as conservation assessments \cite{doi:10.1098/rsbl.2005.0417}. 

Both phenomenological and mechanistic models were compared in this study to analyze the effect of temperature on trait performance. Phenomenological models include; a cubic polynomial which is unimodal and asymmetrical in shape as well as Briere's model that accounts for upper and lower temperature thresholds \cite{10.1093/ee/28.1.22}. The mechanistic models chosen were variations of the Schoolfield-Sharpe model that consider  reversible enzyme denaturation at high (S1), low temperatures (S2) or both (S3).
Formulated from the Sharpe and DeMichele model which was unsuitable for non-linear regression, three new thermodynamic parameters were introduced which have a more intuitive biological interpretation: (1) a development rate at a reference temperature that assumes no enzyme activity; (2) a temperature at which enzyme activity is half low temperature inactive; and (3) a temperature at which enzyme activity is half high temperature inactive. \cite{SCHOOLFIELD1981719}.

 Relatvely few studies have measured performance at a large scale to distinguish between underlying shpes and phenomena \cite{pub.1026914980} \cite{Dowd1956}. The purpose of this study was to conduct a broad-scale comparative analysis of the performance of phenomenological and mechanistic models on thermal response data.

 \section{Methods}
 \subsection{Data}
 Metabolic trait data was derived from the BioTraits dataset accumulated by Dell \textit{et al.,} (2011) . This included approximately 2,445 intraspecific temperature responses for growth, respiration and photosynthesis rates in plants and bacteria from terrestrial and aquatic environments. 
 TPCs with positive and non zero trait values were selected and those with 6 or more observations were included in the analysis. A minimum of 6 data points was chosen in order to successfully fit the full Schoolfield model which requires at least 6 observations. A total of 1,577 TPCs were fitted with both phenomenological and mechanistic models to assess the effect of temperature on biological trait values. The data for analysis were subsetted and exported using Python 3.6.7, the pandas and numpy libraries.
 
 \subsection{Model fitting}
  \subsubsection{Phenomenological Models}
Two different phenomenological models were used in this study. A generic cubic polynomial model was fit to each TPC using Ordinary Least Squares as it is often used to describe unimodal data. 

\begin{equation}
\beta = \beta_0 + \beta_1 T + \beta_2 T^2 + \beta_3 T^3\tag{1}
\end{equation}

\(\beta\), is the trait of interest (respiration, growth or photosynthesis), \(T\) is temperature (\degree C) and \(\beta0\), \(\beta1\) , \(\beta2\)  and \(\beta3\) are coefficients of the function lacking any mechanistic interpretation.  

Briere's model is a 3 parameter model that describes the non-linear relationship of developmental rates for insect species (Briere \textit et al., 1999). This empirical function was used as it accounts for upper and lower temperature thresholds, asymmetry about the optimum temperature, presence of an inflection point and a sharp decline in developmental rate above optimum temperature. 

\begin{equation}
\beta = \beta_0 T (T-T_0) \sqrt{T_m-T}\tag{2}
\end{equation}

\(\beta\) represents the trait value where \(T_0\) is the minimum feasible temperature (\degree C) and \(T_m\) is the maximum temperature (\degree C) that a trait can withstand before going to 0 \degree C. \(\beta_0\) is the normalization constant and was initialized as 1 for TPC fitting. \(T_0\) was estimated as the minimum temperature and \(T_m\) as the maximum temperature recorded for each TPC.

\subsubsection{Mechanistic Models}
The mechanistic models fitted were variations of the Schoolfield model based on thermodynamics and enzyme kinetics \cite{schoolfield1981non}. The full model contains 6 parameters including both high and low deactivation energy.

\begin{equation}
\beta = \frac{\beta_0 e^{\frac{-E}{k} (\frac{1}{T} - \frac{1}{283.15})}}
{ 1 + e^{\frac{E_l}{k} (\frac{1}{T_l} - \frac{1}{T})} + 
	e^{\frac{E_h}{k} (\frac{1}{T_h} - \frac{1}{T})}}\tag{3}
\end{equation}

k is the Boltzmann constant (8.617×10−5 eV ⋅ K−1).  \(\beta\) represents the value of the trait at a given temperature (T) in Kelvin (K = ∘C + 273.15). \(\beta_0\) is the trait value that corresponded to the temperature closest to 278.15 K (5\degree C), controlling the vertical offset of the curve. \(E\) is  the activation energy (eV) and controls the rise of the curve up to the peak in the “normal operating range” for the enzyme. \(E_l\) is the enzyme's low-temperature de-activation energy (eV) which controls the behavior of the enzyme (and the curve) at very low temperatures while \(E_h\) is the enzyme's high-temperature de-activation energy (eV), controlling the behavior of the enzyme at very high temperatures. \(T_l\) is the temperature at which the enzyme is 50\% low-temperature deactivated and \(T_h\)  is the temperature at which the enzyme is 50\% high-temperature deactivated. The simplified models are similar to the full model disregarding either high temperature (4) or low temperature deactivation (5):

\begin{equation}
\beta = \frac{\beta_0 e^{\frac{-E}{k} (\frac{1}{T} - \frac{1}{283.15})}}
{ 1  + e^{\frac{E_l}{k} (\frac{1}{T_l} - \frac{1}{T})}}\tag{4}
\end{equation}

\begin{equation}
\beta = \frac{\beta_0 e^{\frac{-E}{k} (\frac{1}{T} - \frac{1}{283.15})}}
{ 1  + e^{\frac{E_h}{k} (\frac{1}{T_h} - \frac{1}{T})}}\tag{5}
\end{equation}


\(\beta_0\) was initialized as the untransformed trait value corresponding to the temperature closest to 278.15 K (5\degree C). From here, each TPC was divided into two sections either side of the peak. The peak was calculated as the highest trait value and it's corresponding temperature. The first section, or left hand side of the curve, comprised of temperatures and their corresponding trait values below the peak while the second section, or right hand side of the curve, contained values above the peak. For each section, temperature data were multiplied by 1/k and trait values logged. A linear regression was then fit to the data and starting parameter estimates were calculated. For the left hand side of the curve, below the peak, \(E\) was calculated as the absolute value of the slope of the line. \(T_l\) was recorded as the temperature (transformed from 1/kt to K) from which the mean logged trait value was taken and the 1/kt value calculated from the regression line. \(E_l\) was assumed to be half the value of \(E\). For the left hand side of the curve, below the peak, \(E_h \) was recorded as the slope of the line and \(T_h\) was estimated similar to \(T_l\). For cases in which above or below peak data contained 1 point or were absent, \(E\) was initialized as 0.65 and \(E_h \) as 3 times \(E\) to reflect a sharper slope as trait values decline with increasing temperature. \(T_l\) was estimated as the lowest tempertaure and \(T_h\) as the maximum temperture.

Apart from the cubic model, all models were fit in R Studio 3.2.3 using non-linear least squares methods. The nlsLM function was used to incorporate the Levenberg-Marquardt fitting algorithm, returning a vector of weighted residuals whose sum of square was minimized (R documentation). Parameters were bounded and optimized within the function. Estimated starting parameters for all 3 Schoolfield models were fitted and then randomized with a gaussian fluctuation before re-fitting. Each Schoolfield model was fitted to the TPC 20 times, once with the original estimated parameters and 19 times with starting values randomly sampled from a gaussian distribution with a mean of the calculated parameter and ditribution of 0.05. The convergence rate was recorded as the number of successful fits achieved out of a total of 20 attempts. 

\subsection{Model Selection}
Models with the best fit for each individual TPC were defined as those with the lowest Akaike Information Criterion \(\Delta AIC_c\) score. \(AIC_c\), a second order derivative of the original \(AIC\), contains a bias correction term for small sample size and is suggested as an appropriate selection tool when the number of parameters exceed n/40, n referring to sample size \cite{article2}. \(AIC\) or \(AIC_c\) is often used to find the best approximating model to the unknown data as it accounts for the sum of squares, goodness-of-fit measure, and varying numbers of parameters \cite{citeulike:4425594}. The original \(AIC\) equation, used in calculating \(AIC_c\) is as follows;

\begin{equation}
AIC = -2log({\mathcal{L}}(\hat{\theta}\mid y)) + 2k \tag{6}
\end{equation}

where $\mathcal{L}(\hat{\theta}\mid y)$ is the log-likelihood at it's maximum point, corresponding to the probability of the data given a model. \(k\) is defined as the number of free parameters in the model. An alternative formula to calculate \(AIC_c\) , proposed by Hurvich \& Tsai (1989), was used to prevent values tending to infinity;

\begin{equation}
AIC_c = AIC + \frac{2k(k+1)(k+2)}{max(n,k +3) - k - 2}\tag{7}
\end{equation}

\(k\) is the number of parameters in the fitted model and \(n\) the number of observations. For phenomenological models which were not fit with varying starting parameters, the best model was taken as that with the lowest \(AIC_c\). When fitting the mechanistic models \(AIC_c\), was rescaled to \(\Delta AIC_c\) using the following equation;

\begin{equation}
\Delta_i = AIC_c i - AIC_c min \tag{8}
\end{equation}


\( AIC_c \) \textunderscore i is the \(AIC_c\) for the ith model and \(AIC_c\)\textit{min} is the minimum \(AIC_c\) among all models. The larger \(\Delta_i\), the weaker the model. The best model was considered to be the model in which \(\Delta AIC\) was equal to 0 (minimum \(\Delta AIC\) score in the TPC) \cite{article3}. Each TPC was then plotted with the best selected fit per model and analyzed visually. An Akaike weight, W\textunderscore i ( \(AIC_c\) ), was used for model averaging, representing the probability that the model chosen is the best model for the observed data.

\begin{equation}
W_{\text{i}} = \frac{exp(-\Delta_i/2)}{\sum_{r = 1}^{R} exp(-\Delta_i/2))}\tag{9}
\end{equation}

W\textunderscore i is the weight of evidence in favour of the model. These depend on the full set of models and must sum to 1. R in the denominator incorporates the summation of all \(AIC_c\) weights to generate this ratio.

\section{Results}
A total of 1,577 TPCs were analyzed following data manipulation. The sample size per TPC did not follow a normal distrbution, ranging from 6 to 637 samples with a median value of 8. 75\% of curves contained 13 values or less (see Appendix 1.1). Both phenomenological and mechanistic models fit the majority of the data, as seen in table 1, with Cubic and Briere fitting all curves compared to the Schoolfield models. Among the mechanistic models, those simplified with fewer parameters (S1 and S2) achieved a greater number of fits. Convergence was defined as the proportion of fits out of 20 attempts for each Schoolfield model. The high energy deactivation Schoolfield model (S1) converged more on average compared to the full Schoolfield model which had the lowest convergence rate.\\

\begin{table}[H]
\FloatBarrier
\centering
\caption{Number of successful model fits and proportion per model type for each Temperature Performance Curve across the entire dataset. Convergence rate, average number of successful fits out of 20 attempts, also included for all Schoolfield models.}
\begin{adjustbox}{height = 1.7cm, width=11cm}
\centering
\input{"../Results/Table1.tex"} 
\FloatBarrier
\end{adjustbox}
\end{table} 

Upon visual inspection of TPCs, mechanistic models S1 and S3, often demonstrated a good fit and successfully captured the gradual rise and sharp fall of full TPC curves. The low temperature deactivation Schoolfield model (S2) was in general insufficient at fitting to the observed data. Briere was suitable for full TPCs but did not always fit curves outside of this trend. Both Briere and the Schoolfield models however were not as flexible as the Cubic model which fit to more TPCs, often demonstrating a roughly good fit. Figure 1, illustrates the range of fits achieved for a full TPC. Table 2 confirms that Briere provided the best fit for subfigure (a) followed by the Cubic model and S1 which had the lowest \(\Delta AIC_c\) out of the mechanistic models. S1 was the best fitting model for subfigure (b) also reflected in the accompanying \(\Delta AIC_c\). According the table 2, Cubic would be the next best model which visually, is inaccurate.

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[height = 12cm, width=1.3\linewidth]{../Results/Models_fitted/MTD2100.pdf}.
		\caption{Green Seaweed \textit{Caulerpa serrulata} }
		\label{fig:sub1}
	\end{subfigure}%
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[height = 12cm, width=1.3\linewidth]{../Results/Models_fitted/MTD2170.pdf}
		\caption{ Proteobacteria \textit{Escherichia colia}}
		\label{fig:sub2}
	\end{subfigure}
	\caption{Two typical TPCs demonstrating all 5 models fit to observed data. a) All models captured data well, particularly Briere. b) Only the mechanistic models, particularly S1	and S3, come close to an optimal fit.}
	\label{fig:test}
\end{figure}



\vspace{0.3cm}
\begin{table}[H]
\FloatBarrier
\centering
\caption{\(\Delta AIC_c\) results for all models fitted to the TPCs in Figure 1.}
\begin{adjustbox}{height = 1.3cm, width=12cm}
	\input{"../Results/Table2.tex"}
	\FloatBarrier
\end{adjustbox}
\end{table}
\vspace{0.5cm}
Model performance was assessed by evaluating the proportion of best fitting models, according to their \(\Delta AIC_c\) value, across the entire dataset and between groups. In figure 2, it is evident that the Cubic model was selected most frequently as the best fitting model, followed by the high temperature deactivation Schoolfield model (S1), Briere and the remainder of the Schoolfield models. The low temperature deactivation Schoolfield model had the lowest number of best fits within the overall dataset. 

\begin{figure}[H]
 	\includegraphics[width=0.8\textwidth]{../Results/Fig_2.pdf}
 	\centering
 	\caption{Number of times each model was selected as the best model per TPC, according to \(\Delta AIC_c\) score, within the entire dataset (n = 1577).}
\end{figure}

Model performance was also assessed between different trait values which were grouped under the following categories; Photosynthesis, Respiration and Growth. From figure 3, it is evident that the cubic model comprised of the largest proportion of best fits. The poorest performing models, S2 and S3, were only fit to growth and respiration data.

\begin{figure}[H]
	\includegraphics[width=10cm, height=10cm]{../Results/Fig_3.pdf}
	\centering
	\caption{Proportion of  best models selected for each trait type summarized into relative categories; Photosynthesis, Growth and Respiration. Best model was selected according to \(\Delta AIC_c\) score, within the entire dataset (n = 1577).}
\end{figure}

In figure 4, the general pattern of model performance between kingdoms of consumers was observed. The kingdoms Archae and Protozoa strongly favoured phenomenological models; Cubic and Briere selected as the best models respectively. Protozoa was the only kingom in which no mechanistic models provided the best fit. Apart from the high temperature deactivation Schoolfield model across all other kingdoms, the best fits for the low temperature deactivation and full Schoolfield model were present only in Bacteria and Plantae.

\begin{figure}[H]	\includegraphics[width=18cm, height=10cm]{../Results/Fig_4.pdf}
	\centering
	\caption{Proportion of  best models selected for each Kingdom of consumers. Best model was selected according to \(\Delta AIC_c\) score, within the entire dataset (n = 1577).}
\end{figure}


The evidence for the strength of fit for each model was calculated by categorizing \(\Delta AIC_c\) scores according to guidelines adapted by Burnham \& Anderson (2004); models with \(\Delta AIC_c\) $\leq$ 2 show substantial support; those in which 4 $\leq$ \(\Delta AIC_c\) $\leq$ 7 have considerably less support; and those with \(\Delta AIC_c\) \textgreater 10 have no support. In table 3, strength of fit was investigated for TPCs in which all models fit the observed data. It is clear that the Cubic model out-performed other models two to three times over in which it had the strongest supporting evidence. The high temperature deactivation Schoolfield model comprised of a relatively large proportion of strongly supported models in comparison to the remaining models. The low temperature deactivation energy and full Schoolfield models (S2 and S3) had little to no support. This is reflected in \(AIC_c\) weights (figure 5) with the cubic model possessing a greater proportion of higher weights, followed by the simplified Schoolfield high energy deactivation model (S1). Both models demonstrate a higher probability of being the model that best describes the data.

\vspace{0.7cm}
\begin{table}[H]
	\FloatBarrier
	\caption{\(\Delta AIC_c\) scores TPCs in which all models converged.  Scores fall into respective categories as per the recommended guidelines. Categories represent strength of fit, with lower \(\Delta AIC_c\) indicative of supportive evidence in favour of the model (n = 1156).}
\begin{adjustbox}{height = 2.7cm, width=15cm}
		\centering
	\input{"../Results/Table3.tex"}
	\FloatBarrier
\end{adjustbox}
\end{table}




\begin{figure}[H]
	\includegraphics[width=10cm, height=10cm]{"../Results/Fig_5.pdf}
	\centering
	\caption{Distribution of Akaike weights for each model. Weightages were calculated for TPCs in which all models converged (n = 1156).}
\end{figure}

\section{Discussion}

Which model is 'best'? At first, the answer may seem straightforward but on further inspection this is not the case, comparing alternative models that make different simplifications with a common biological assumption \cite{article}. The goal of non-linear regression is to minimize the sum-of-squares and so it appears that the model with the smallest value is best. However, this is often not applicable when  models have varying numbers of parameters, and therefore different inflection points. Any method to compare a simple model with a more complicated one must balance the decrease in sum-of-squares with the increase in the number of parameters. From analyzing the data, it is clear that the Cubic model was generally the better fitting model within the dataset and between Trait types and Kingdoms. This is possibly due to model flexibility as phenomenological models are not constrained by parameter assumptions. However, this provides little information about the variation in thermal physiology among organisms and so prevents any biological interpretation. 

Mechanistic models are preferable in order to understand the thermal ecology and metabolic adaptations of organisms as well as generate testable predictons for future studies
\cite{article4}\cite{Schulte2015TheEO} \cite{Martin2017PhenomenologicalVB} \cite{delong2017combined}. The best fitting mechanistic model was the Schoolfield high temperature deactivation model (S1) which may be a consequence of experimental limitations \cite{schoolfield1981non}, for example if organisms have only been studied over part of the temperature spectrum. Compared to S2 and S3, which both contain low temperature deactivation parameters, S1 performed significantly better. This may be due TPCs containing higher temperature values and/or to the fact that low temperature deactivation is difficult to detect \cite{pawar2016real}.

Another plausible explanation for observed model performance lies in the calculated parameter estimates. General assumptions applied to the entire dataset can lead to over or underestimated values for individual TPCs. For example, the normalization constant ,\(\beta_0\), which standardizes rate performance across groups, is particularly susceptible to overestimating trait values at the selected reference temperature \cite{kontopoulos2018use}. Parameters such as \(T_h\) and \(T_l\) were also observed to be unrealistic in certain datasets. The mean activation energy for each model was close to the reported activation energy of 0.65 eV with S1 having the closest mean value. Parameters were bound and optimized using the Levenberg-Marquardt algorithm as part of nlsLM function which is the virtual standard in optimization. However this approach is not immune to faults with a generally slow convergence rate and probability of getting lost in parameter space \cite{article14}.

Model selection was chosen on the basis of fit and complexity to compare all models simultaneously using \(AIC\). Instead of the hypothesis testing approach, associated with the likelihood ratio test, or \(R^2\) measure of fit which is inappropriate for non-liner regression \cite{spiess2010evaluation}, \(AIC\) combines the Kullback-Leiber distance, measure of discrepancy, and Fisher's maximized log-likelihood to select a parsimonious model to analyze empirical data \cite{akaike1998information}.
Even in moderate sample sizes, the second order derivative \(AIC_c\) provides substantially better model selections than \(AIC\) \cite{10.1093/biomet/78.3.499}. One major disadvantage to this approach was that values tended to inifinity when the sample size, n, was equal to the number of parameters, k + 1, which occured for the full Schoolfield model (k = 6). An alternative formula was used to avoid omitting data but is not well explored in the literature. 



\bibliographystyle{apacite}
\bibliography{References.bib}

\end{linenumbers}

\section{Appendices}
\subsubsection{Appendix 1}
\begin{figure}
\includegraphics[width=0.98\textwidth]{"../Results/Samples_boxplot.pdf}
\centering
\caption{Boxlplot illustrating the range of observtions per Thermal Performance Curve. Outliers are labelled}
\end{figure}

 

\end{document}